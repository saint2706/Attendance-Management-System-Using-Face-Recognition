{% extends "recognition/base.html" %}
{% load static %}

{% block extra_head %}
    <link rel="stylesheet" href="{% static 'css/app.css' %}">
{% endblock %}

{% block content %}
    <div class="row">
        <div class="col-md-6 offset-md-3">
            <h1 class="text-center">Mark Your Attendance</h1>
            <form id="attendance-form" action="{% url 'mark-your-attendance' %}" method="post">
                {% csrf_token %}
                <button type="submit" class="btn btn-primary btn-block">Mark In</button>
            </form>
            <form id="attendance-out-form" action="{% url 'mark-your-attendance-out' %}" method="post">
                {% csrf_token %}
                <button type="submit" class="btn btn-secondary btn-block mt-2">Mark Out</button>
            </form>

            <div id="task-status-container" class="mt-4">
                <h3>Task Status</h3>
                <p id="task-status">Status: PENDING</p>
                <p id="task-result">Result:</p>
            </div>
        </div>
    </div>
{% endblock %}

{% block extra_scripts %}
    <script src="{% static 'js/task-poll.js' %}"></script>
    <script>
        document.getElementById('task-status-container').style.display = 'none';

        document.getElementById('attendance-form').addEventListener('submit', function(event) {
            event.preventDefault();
            const form = event.target;
            fetch(form.action, {
                method: 'POST',
                headers: {
                    'X-CSRFToken': form.querySelector('[name=csrfmiddlewaretoken]').value
                }
            })
            .then(response => response.json())
            .then(data => {
                document.getElementById('task-status-container').style.display = 'block';
                pollTaskStatus(data.task_id, 'task-status', 'task-result');
            });
        });
        document.getElementById('attendance-out-form').addEventListener('submit', function(event) {
            event.preventDefault();
            const form = event.target;
            fetch(form.action, {
                method: 'POST',
                headers: {
                    'X-CSRFToken': form.querySelector('[name=csrfmiddlewaretoken]').value
                }
            })
            .then(response => response.json())
            .then(data => {
                document.getElementById('task-status-container').style.display = 'block';
                pollTaskStatus(data.task_id, 'task-status', 'task-result');
            });
        });
    </script>
{% endblock %}
